<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RestaurantePro - Sistema de Vendas</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="container" style="position:relative;">
                <h1><i class="fas fa-utensils"></i> RestaurantePro</h1>
                <!-- HAMBURGER MENU BUTTON FOR MOBILE -->
                <button id="hamburger-btn" class="hamburger-btn" aria-label="Abrir menu" aria-expanded="false" aria-controls="mobile-nav">
                    <span class="hamburger-bar"></span>
                    <span class="hamburger-bar"></span>
                    <span class="hamburger-bar"></span>
                </button>
                <!-- MAIN NAVIGATION -->
                <nav id="main-nav" class="main-nav">
                    <button class="nav-btn active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                    <button class="nav-btn" data-section="menu">
                        <i class="fas fa-utensils"></i> Menu
                    </button>
                    <button class="nav-btn" data-section="orders">
                        <i class="fas fa-receipt"></i> Pedidos
                    </button>
                    <button class="nav-btn" data-section="inventory">
                        <i class="fas fa-boxes"></i> Estoque
                    </button>
                    <button class="nav-btn" data-section="analytics">
                        <i class="fas fa-chart-line"></i> Relatórios
                    </button>
                    <button class="nav-btn" data-section="purchases">
                        <i class="fas fa-shopping-cart"></i> Compras
                    </button>
                    <button class="nav-btn" data-section="finances">
                        <i class="fas fa-dollar-sign"></i> Financeiro
                    </button>
                    <button class="nav-btn" data-section="settings">
                        <i class="fas fa-cog"></i> Configurações
                    </button>
                </nav>
                <!-- MOBILE SLIDING MENU -->
                <nav id="mobile-nav" class="mobile-nav" aria-label="Navegação principal">
                    <div class="mobile-nav-header">
                        <span>Menu</span>
                        <button id="close-mobile-nav" aria-label="Fechar menu">&times;</button>
                    </div>
                    <button class="nav-btn" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                    <button class="nav-btn" data-section="menu">
                        <i class="fas fa-utensils"></i> Menu
                    </button>
                    <button class="nav-btn" data-section="orders">
                        <i class="fas fa-receipt"></i> Pedidos
                    </button>
                    <button class="nav-btn" data-section="inventory">
                        <i class="fas fa-boxes"></i> Estoque
                    </button>
                    <button class="nav-btn" data-section="analytics">
                        <i class="fas fa-chart-line"></i> Relatórios
                    </button>
                    <button class="nav-btn" data-section="purchases">
                        <i class="fas fa-shopping-cart"></i> Compras
                    </button>
                    <button class="nav-btn" data-section="finances">
                        <i class="fas fa-dollar-sign"></i> Financeiro
                    </button>
                    <button class="nav-btn" data-section="settings">
                        <i class="fas fa-cog"></i> Configurações
                    </button>
                </nav>
                <div class="sync-status">
                    <div id="sync-indicator" class="sync-indicator" onclick="toggleSyncReport()">
                        <i class="fas fa-database"></i>
                        <span id="sync-badge" class="sync-badge" style="display: none;">0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="container">
                <h2>Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="card metric-card">
                        <div class="card-header">
                            <h3>Vendas Hoje</h3>
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="card-body">
                            <div class="metric-value" id="todaySales">R$ 0,00</div>
                            <div class="metric-change" id="todaySalesChange">+0%</div>
                        </div>
                    </div>
                    <div class="card metric-card">
                        <div class="card-header">
                            <h3>Lucro Hoje</h3>
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-body">
                            <div class="metric-value" id="todayProfit">R$ 0,00</div>
                            <div class="metric-change" id="todayProfitChange">+0%</div>
                        </div>
                    </div>
                    <div class="card metric-card">
                        <div class="card-header">
                            <h3>Pedidos Hoje</h3>
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="card-body">
                            <div class="metric-value" id="todayOrders">0</div>
                            <div class="metric-change" id="todayOrdersChange">+0%</div>
                        </div>
                    </div>
                    <div class="card metric-card">
                        <div class="card-header">
                            <h3>Itens em Estoque</h3>
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="card-body">
                            <div class="metric-value" id="stockItems">0</div>
                            <div class="metric-change warning" id="stockAlert">0 críticos</div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-charts">
                    <div class="card">
                        <div class="card-header">
                            <h3>Vendas vs Lucro (7 dias)</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Resumo Financeiro</h3>
                        </div>
                        <div class="card-body">
                            <div id="financialSummary"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Menu Section -->
        <section id="menu" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Menu</h2>
                    <button class="btn btn-primary" onclick="openMenuModal()">
                        <i class="fas fa-plus"></i> Adicionar Item
                    </button>
                </div>
                <!-- BEGIN: Responsive container for menu items -->
                <div class="menu-grid" id="menuGrid" aria-live="polite" style="margin-bottom:2rem; touch-action:pan-y;">
                    <!-- Menu items will be populated here -->
                </div>
                <!-- END -->
            </div>
        </section>

        <!-- Orders Section -->
        <section id="orders" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Pedidos</h2>
                    <button class="btn btn-primary" onclick="openOrderModal()">
                        <i class="fas fa-plus"></i> Novo Pedido
                    </button>
                </div>
                <div class="orders-container">
                    <div class="orders-tabs">
                        <button class="tab-btn active" data-status="all">Todos</button>
                        <button class="tab-btn" data-status="pending">Pendentes</button>
                        <button class="tab-btn" data-status="preparing">Preparando</button>
                        <button class="tab-btn" data-status="ready">Prontos</button>
                        <button class="tab-btn" data-status="delivered">Entregues</button>
                        <button class="tab-btn" data-status="cancelled">Cancelados</button>
                    </div>
                    <div class="orders-list" id="ordersList">
                        <!-- Orders will be populated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Inventory Section -->
        <section id="inventory" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Controle de Estoque</h2>
                    <button class="btn btn-primary" onclick="openInventoryModal()">
                        <i class="fas fa-plus"></i> Adicionar Item
                    </button>
                </div>
                <div class="inventory-filters">
                    <input type="text" id="inventorySearch" placeholder="Buscar item no estoque..." class="search-input">
                    <select id="inventoryFilter" class="filter-select">
                        <option value="all">Todos os itens</option>
                        <option value="low">Estoque baixo</option>
                        <option value="critical">Estoque crítico</option>
                    </select>
                </div>
                <div class="inventory-table-container">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Quantidade</th>
                                <th>Unidade</th>
                                <th>Estoque Mínimo</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 2rem; color: #64748b;">
                                    Carregando itens do estoque...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="section">
            <div class="container">
                <h2>Relatórios</h2>

                <!-- FILTRO DE PERÍODO: Analytics -->
                <div class="analytics-filter-bar" style="margin: 1rem 0 2rem 0; display: flex; gap: 1.5rem; align-items: flex-end; flex-wrap: wrap;">
                    <div>
                        <label for="analyticsDateFrom" style="font-size: 0.92em; color: #64748b; margin-bottom: 0.15rem; display: block;">De:</label>
                        <input type="date" id="analyticsDateFrom" class="search-input" style="width: 160px;">
                    </div>
                    <div>
                        <label for="analyticsDateTo" style="font-size: 0.92em; color: #64748b; margin-bottom: 0.15rem; display: block;">Até:</label>
                        <input type="date" id="analyticsDateTo" class="search-input" style="width: 160px;">
                    </div>
                    <button class="btn btn-secondary" id="analyticsFilterBtn" style="height:42px;">
                        <i class="fas fa-filter"></i> Filtrar Período
                    </button>
                    <button class="btn btn-small btn-secondary" id="analyticsClearFilterBtn" style="height:42px; margin-left:0.5em;display:none;">
                        Limpar Filtro
                    </button>
                </div>

                <div class="analytics-full-reports">
                    <!-- Vendas por Categoria e Top Itens -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Vendas por Categoria (Total)</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="categoryChart"></canvas>
                            <div class="top-sales-category" id="topSalesCategory"></div>
                        </div>
                    </div>
                    <!-- Tendência de Vendas e Média Pedido -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Tendência de Vendas Mensais</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="trendChart"></canvas>
                            <div style="margin-top:1.3rem;" id="avgOrderValueTrend"></div>
                        </div>
                    </div>
                    <!-- Top Itens Vendidos -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Top 10 Itens Vendidos</h3>
                        </div>
                        <div class="card-body">
                            <div id="topMenuItems"></div>
                        </div>
                    </div>
                    <!-- Ranking de Clientes -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Top Clientes</h3>
                        </div>
                        <div class="card-body">
                            <div id="topClients"></div>
                        </div>
                    </div>
                    <!-- Estatísticas Gerais e Pedidos por Plataforma -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Estatísticas Avançadas</h3>
                        </div>
                        <div class="card-body">
                            <div id="generalStats"></div>
                            <canvas id="ordersByPlatformChart" style="margin-top:2rem;"></canvas>
                        </div>
                    </div>
                    <!-- NOVA ÁREA DE CANCELAMENTOS (Relatório Exclusivo) -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Relatório de Cancelamentos</h3>
                        </div>
                        <div class="card-body">
                            <div id="cancellationReport"></div>
                        </div>
                    </div>
                    <!-- NOVA ÁREA DE TAXAS E DESCONTOS (Relatório Exclusivo) -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Relatório de Taxas e Descontos</h3>
                        </div>
                        <div class="card-body">
                            <div id="feesReport"></div>
                        </div>
                    </div>
                    <!-- Movimentações de Estoque -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Movimentações de Estoque</h3>
                        </div>
                        <div class="card-body">
                            <div id="stockMovementReport"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Purchases Section -->
        <section id="purchases" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Compras</h2>
                    <button class="btn btn-primary" onclick="openPurchaseModal()">
                        <i class="fas fa-plus"></i> Nova Compra
                    </button>
                </div>
                <div class="purchases-container">
                    <div class="purchases-tabs">
                        <button class="tab-btn active" data-status="all">Todas</button>
                        <button class="tab-btn" data-status="pending">Pendentes</button>
                        <button class="tab-btn" data-status="completed">Finalizadas</button>
                    </div>
                    <div class="purchases-list" id="purchasesList">
                        <!-- Purchases will be populated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Finances Section -->
        <section id="finances" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Financeiro</h2>
                    <button class="btn btn-primary" onclick="openExpenseModal()">
                        <i class="fas fa-plus"></i> Nova Despesa
                    </button>
                </div>
                <div class="finances-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Resumo Mensal</h3>
                        </div>
                        <div class="card-body">
                            <div class="finance-summary" id="monthlyFinances">
                                <div class="finance-item">
                                    <span class="finance-label">Receita:</span>
                                    <span class="finance-value revenue" id="monthlyRevenue">R$ 0,00</span>
                                </div>
                                <div class="finance-item">
                                    <span class="finance-label">Custos dos Produtos:</span>
                                    <span class="finance-value cost" id="monthlyCosts">R$ 0,00</span>
                                </div>
                                <div class="finance-item">
                                    <span class="finance-label">Despesas:</span>
                                    <span class="finance-value expense" id="monthlyExpenses">R$ 0,00</span>
                                </div>
                                <div class="finance-item total">
                                    <span class="finance-label">Lucro Líquido:</span>
                                    <span class="finance-value profit" id="monthlyProfit">R$ 0,00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Fluxo de Caixa</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="expenses-section">
                    <div class="card">
                        <div class="card-header">
                            <h3>Despesas Recentes</h3>
                        </div>
                        <div class="card-body">
                            <div class="expenses-list" id="expensesList">
                                <!-- Expenses will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section">
            <div class="container">
                <h2>Configurações</h2>
                <div class="settings-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Configurações do Sistema</h3>
                        </div>
                        <div class="card-body">
                            <div class="setting-item">
                                <label>Sincronização Automática</label>
                                <input type="checkbox" id="autoSync" checked>
                            </div>
                            <div class="setting-item">
                                <label>Notificações de Estoque Baixo</label>
                                <input type="checkbox" id="lowStockNotifications" checked>
                            </div>
                            <div class="setting-item">
                                <label>Backup Automático</label>
                                <input type="checkbox" id="autoBackup" checked>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Taxas de Pagamento</h3>
                        </div>
                        <div class="card-body">
                            <div class="setting-item">
                                <label>Taxa Cartão de Crédito (%)</label>
                                <input type="number" id="creditCardFee" step="0.01" min="0" max="100" value="3.5" onchange="app.savePaymentFees()">
                            </div>
                            <div class="setting-item">
                                <label>Taxa Cartão de Débito (%)</label>
                                <input type="number" id="debitCardFee" step="0.01" min="0" max="100" value="2.5" onchange="app.savePaymentFees()">
                            </div>
                            <div class="setting-item">
                                <label>Taxa PIX (%)</label>
                                <input type="number" id="pixFee" step="0.01" min="0" max="100" value="0.99" onchange="app.savePaymentFees()">
                            </div>
                            <div class="setting-item">
                                <label>Taxa Ifood (%)</label>
                                <input type="number" id="ifoodFee" step="0.01" min="0" max="100" value="12.0" onchange="app.savePaymentFees()">
                            </div>
                            <div class="setting-item">
                                <label>Investimento Ifood (%)</label>
                                <input type="number" id="ifoodInvestment" step="0.01" min="0" max="100" value="5.0" onchange="app.savePaymentFees()">
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Banco de Dados</h3>
                        </div>
                        <div class="card-body">
                            <div class="db-status">
                                <div class="db-item">
                                    <span class="db-label">MySQL:</span>
                                    <span class="db-status-indicator" id="mysqlStatus">Desconectado</span>
                                </div>
                                <div class="db-item">
                                    <span class="db-label">SQLite:</span>
                                    <span class="db-status-indicator" id="sqliteStatus">Conectado</span>
                                </div>
                                <div class="db-item">
                                    <span class="db-label">IndexedDB:</span>
                                    <span class="db-status-indicator" id="indexeddbStatus">Conectado</span>
                                </div>
                            </div>
                            <div class="db-actions">
                                <button class="btn btn-secondary" onclick="syncDatabases()">
                                    <i class="fas fa-sync"></i> Sincronizar
                                </button>
                                <button class="btn btn-secondary" onclick="exportData()">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="btn btn-secondary" onclick="importData()">
                                    <i class="fas fa-upload"></i> Importar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sync Report Modal -->
        <div id="syncReportModal" class="sync-report-modal">
            <div class="sync-report-header">
                <h3><i class="fas fa-sync-alt"></i> Relatório de Sincronização</h3>
            </div>
            <div class="sync-report-body">
                <div class="sync-stats">
                    <div class="sync-stat">
                        <span class="sync-stat-label">Última Sincronização</span>
                        <span class="sync-stat-value" id="lastSyncTime">Nunca</span>
                    </div>
                    <div class="sync-stat">
                        <span class="sync-stat-label">Total de Operações</span>
                        <span class="sync-stat-value" id="totalOperations">0</span>
                    </div>
                    <div class="sync-stat">
                        <span class="sync-stat-label">Criações</span>
                        <span class="sync-stat-value" id="totalCreates">0</span>
                    </div>
                    <div class="sync-stat">
                        <span class="sync-stat-label">Atualizações</span>
                        <span class="sync-stat-value" id="totalUpdates">0</span>
                    </div>
                    <div class="sync-stat">
                        <span class="sync-stat-label">Exclusões</span>
                        <span class="sync-stat-value" id="totalDeletes">0</span>
                    </div>
                    <div class="sync-stat">
                        <span class="sync-stat-label">Status dos Bancos</span>
                        <span class="sync-stat-value" id="dbStatus">Verificando...</span>
                    </div>
                </div>
                
                <div class="sync-activity">
                    <h4>Atividades Recentes</h4>
                    <div id="syncActivityList">
                        <p style="text-align: center; color: #64748b; font-size: 0.875rem;">Nenhuma atividade recente</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <div id="menuModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Adicionar Item ao Menu</h3>
                    <button class="close" onclick="closeModal('menuModal')">&times;</button>
                </div>
                <form id="menuForm">
                    <div class="form-group">
                        <label>Nome do Item</label>
                        <input type="text" id="menuName" required>
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="menuCategory" required>
                            <option value="">Selecione uma categoria</option>
                            <option value="dogao">Dogão do Canela Fina</option>
                            <option value="burger">Burger e Otakus</option>
                            <option value="sobremesas">Sobremesas</option>
                            <option value="bebidas">Bebidas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Preço de Venda</label>
                        <input type="number" id="menuPrice" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Custo do Produto</label>
                        <input type="number" id="menuCostPrice" step="0.01" readonly>
                        <small style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem; display: block;">
                            O custo será calculado automaticamente com base nos ingredientes selecionados.
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Descrição</label>
                        <textarea id="menuDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ingredientes do Estoque</label>
                        <div id="menuIngredients">
                            <!-- Menu ingredients will be populated here -->
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="app.addMenuIngredient()">
                            <i class="fas fa-plus"></i> Adicionar Ingrediente
                        </button>
                        <small style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem; display: block;">
                            Vincule os ingredientes do estoque que são necessários para este item do menu. O estoque será deduzido automaticamente a cada venda.
                        </small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('menuModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="orderModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Novo Pedido</h3>
                    <button class="close" onclick="closeModal('orderModal')">&times;</button>
                </div>
                <form id="orderForm">
                    <div class="form-group">
                        <label>Cliente</label>
                        <input type="text" id="orderCustomer" required>
                    </div>
                    <div class="form-group">
                        <label>Plataforma</label>
                        <select id="orderPlatform" required onchange="app.updatePaymentMethods()">
                            <option value="vendas">Vendas Internas</option>
                            <option value="ifood">Ifood</option>
                        </select>
                    </div>
                    <div class="form-group" id="paymentMethodGroup">
                        <label>Forma de Pagamento</label>
                        <select id="orderPaymentMethod" required onchange="app.updateOrderTotal()">
                            <option value="">Selecione a forma de pagamento</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="credito">Cartão de Crédito</option>
                            <option value="debito">Cartão de Débito</option>
                            <option value="pix">PIX</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Itens do Pedido</label>
                        <div id="orderItems">
                            <!-- Order items will be populated here -->
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addOrderItem()">
                            <i class="fas fa-plus"></i> Adicionar Item
                        </button>
                    </div>
                    <div class="form-group">
                        <label>Subtotal: <span id="orderSubtotal">R$ 0,00</span></label>
                        <div id="orderFeeInfo" style="margin-top: 0.5rem; font-size: 0.875rem; color: #64748b;"></div>
                        <label style="font-weight: 700; color: #059669; font-size: 1.1rem;">Total: <span id="orderTotal">R$ 0,00</span></label>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('orderModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Criar Pedido</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="inventoryModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Adicionar Item ao Estoque</h3>
                    <button class="close" onclick="closeModal('inventoryModal')">&times;</button>
                </div>
                <form id="inventoryForm">
                    <div class="form-group">
                        <label>Nome do Item</label>
                        <input type="text" id="inventoryName" required>
                    </div>
                    <div class="form-group">
                        <label>Quantidade</label>
                        <input type="number" id="inventoryQuantity" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Unidade</label>
                        <select id="inventoryUnit" required>
                            <option value="">Selecione uma unidade</option>
                            <option value="kg">Quilograma (kg)</option>
                            <option value="g">Gramas (g)</option>
                            <option value="l">Litros (l)</option>
                            <option value="ml">Mililitros (ml)</option>
                            <option value="un">Unidades (un)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estoque Mínimo</label>
                        <input type="number" id="inventoryMinStock" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Preço de Custo</label>
                        <input type="number" id="inventoryCostPrice" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Fornecedor</label>
                        <input type="text" id="inventorySupplier">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('inventoryModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="purchaseModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Nova Compra</h3>
                    <button class="close" onclick="closeModal('purchaseModal')">&times;</button>
                </div>
                <form id="purchaseForm">
                    <div class="form-group">
                        <label>Fornecedor</label>
                        <input type="text" id="purchaseSupplier" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Entrega (Opcional)</label>
                        <input type="date" id="purchaseDeliveryDate">
                    </div>
                    <div class="form-group">
                        <label>Itens da Compra</label>
                        <div id="purchaseItems">
                            <!-- Purchase items will be populated here -->
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addPurchaseItem()">
                            <i class="fas fa-plus"></i> Adicionar Item
                        </button>
                    </div>
                    <div class="form-group">
                        <label>Total: <span id="purchaseTotal">R$ 0,00</span></label>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('purchaseModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Criar Compra</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="expenseModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Nova Despesa</h3>
                    <button class="close" onclick="closeModal('expenseModal')">&times;</button>
                </div>
                <form id="expenseForm">
                    <div class="form-group">
                        <label>Descrição</label>
                        <input type="text" id="expenseDescription" required>
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="expenseCategory" required>
                            <option value="">Selecione uma categoria</option>
                            <option value="aluguel">Aluguel</option>
                            <option value="energia">Energia</option>
                            <option value="agua">Água</option>
                            <option value="telefone">Telefone/Internet</option>
                            <option value="funcionarios">Funcionários</option>
                            <option value="marketing">Marketing</option>
                            <option value="equipamentos">Equipamentos</option>
                            <option value="manutencao">Manutenção</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Valor</label>
                        <input type="number" id="expenseAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Data</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('expenseModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="cancelOrderModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-times-circle"></i> Cancelar Pedido</h3>
                    <button class="close" onclick="closeModal('cancelOrderModal')">&times;</button>
                </div>
                <form id="cancelOrderForm">
                    <div class="form-group">
                        <label>Informações do Pedido</label>
                        <div id="cancelOrderInfo" style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #e2e8f0;">
                            <!-- Order info will be populated here -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Quem está cancelando o pedido? *</label>
                        <input type="text" id="cancelOrderBy" required placeholder="Nome de quem está cancelando">
                    </div>
                    <div class="form-group">
                        <label>Motivo do cancelamento (opcional)</label>
                        <textarea id="cancelOrderReason" placeholder="Descreva o motivo do cancelamento..." rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('cancelOrderModal')">Voltar</button>
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-times"></i> Confirmar Cancelamento
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "chart.js": "https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js",
            "chart.js/auto": "https://cdn.jsdelivr.net/npm/chart.js@4.4.0/auto/auto.esm.js"
        }
    }
    </script>

    <script src="database.js"></script>
    <script src="app.js"></script>

    <script>
    // Hamburger menu responsive behavior
    (function() {
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const mobileNav = document.getElementById('mobile-nav');
        const mainNav = document.getElementById('main-nav');
        const closeMobileNav = document.getElementById('close-mobile-nav');

        function openMobileNav() {
            mobileNav.classList.add('active');
            hamburgerBtn.setAttribute('aria-expanded', 'true');
            document.body.classList.add('nav-open');
            // Hide the hamburger when mobile nav is open
            hamburgerBtn.style.visibility = 'hidden';
            hamburgerBtn.style.opacity = '0';
        }

        function closeMobileNavFunc() {
            mobileNav.classList.remove('active');
            hamburgerBtn.setAttribute('aria-expanded', 'false');
            document.body.classList.remove('nav-open');
            // Show the hamburger again
            hamburgerBtn.style.visibility = 'visible';
            hamburgerBtn.style.opacity = '1';
        }

        // Hamburger open
        hamburgerBtn.addEventListener('click', openMobileNav);
        if (closeMobileNav) closeMobileNav.addEventListener('click', closeMobileNavFunc);

        // Hide nav if window is resized to desktop
        window.addEventListener('resize', function() {
            if (window.innerWidth > 900) {
                closeMobileNavFunc();
            }
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if(mobileNav.classList.contains('active') &&
                !mobileNav.contains(e.target) &&
                e.target !== hamburgerBtn &&
                !hamburgerBtn.contains(e.target)) {
                closeMobileNavFunc();
            }
        });

        // Highlight selected nav button
        function setActiveNavBtn(section) {
            // Main nav
            document.querySelectorAll('#main-nav .nav-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.section === section);
            });
            // Mobile nav
            document.querySelectorAll('#mobile-nav .nav-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.section === section);
            });
        }

        // Delegate nav clicks for both navs
        const navHandler = function(event) {
            const section = event.target.closest('.nav-btn')?.dataset?.section;
            if (section) {
                setActiveNavBtn(section);
                closeMobileNavFunc();
            }
        };
        mainNav.addEventListener('click', navHandler);
        mobileNav.addEventListener('click', navHandler);

        // Observe section changes set by app
        window.addEventListener('sectionchange', function(e) {
            setActiveNavBtn(e.detail.section);
        });

        // On load, sync active button
        setTimeout(() => {
            // Get currently active section
            const active = document.querySelector('.section.active');
            if (active) setActiveNavBtn(active.id);
        }, 100);
    })();

    // Add analytics filter bar listeners on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        window.app = new RestaurantApp();

        // Analytics filter: set event listeners
        const analyticsFilterBtn = document.getElementById('analyticsFilterBtn');
        const analyticsClearBtn = document.getElementById('analyticsClearFilterBtn');

        if (analyticsFilterBtn && analyticsClearBtn) {
            analyticsFilterBtn.addEventListener('click', function() {
                window.app.applyAnalyticsPeriodFilter();
            });
            analyticsClearBtn.addEventListener('click', function() {
                window.app.clearAnalyticsPeriodFilter();
            });
        }
    });
    </script>
</body>
</html>